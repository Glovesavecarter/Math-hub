<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Blade Ball | Defensive Engine</title>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: #000;
            color: #fff;
            font-family: 'Inter', sans-serif;
        }
        #unity-container {
            width: 100%;
            height: 100%;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #unity-canvas {
            width: 100%;
            height: 100%;
            background: #231F20;
        }
        #loading-cover {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: #020617;
            z-index: 100;
        }
        .spinner {
            border: 4px solid rgba(99, 102, 241, 0.1);
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border-left-color: #6366f1;
            animation: spin 1s linear infinite;
            margin-bottom: 24px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        #status-text {
            color: #6366f1;
            font-family: 'Orbitron', sans-serif;
            font-weight: 800;
            letter-spacing: 2px;
            text-transform: uppercase;
            font-size: 12px;
            margin-bottom: 16px;
        }
        .progress-container {
            width: 240px;
            height: 2px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
            overflow: hidden;
        }
        #progress-fill {
            width: 0%;
            height: 100%;
            background: #6366f1;
            transition: width 0.3s ease;
            box-shadow: 0 0 10px #6366f1;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@800&family=Inter:wght@400;700&display=swap" rel="stylesheet">
</head>
<body class="dark">
    <div id="unity-container">
        <canvas id="unity-canvas"></canvas>
    </div>

    <div id="loading-cover">
        <div class="spinner"></div>
        <div id="status-text">CALIBRATING TACTICAL CORE... 0%</div>
        <div class="progress-container">
            <div id="progress-fill"></div>
        </div>
    </div>

    <!-- Analytics & Monetization SDKs -->
    <script async src="https://www.google-analytics.com/analytics.js"></script>
    <script type="text/javascript" id="analytics" async src="https://cdn.jsdelivr.net/gh/st39/sdk@main/ga.js"></script>
    <script type="text/javascript" async src="https://imasdk.googleapis.com/js/sdkloader/ima3.js"></script>
    <script type="text/javascript">
        window.SDK_OPTIONS = {
          gameId: "r2tzpy9cgrn2u4xgzc9z0zbtvxm16mby",
          onEvent: function(a) {
            switch (a.name) {
              case "SDK_GAME_PAUSE": break;
              case "SDK_GAME_START": break;
              case "SDK_READY": break;
            }
          }
        };
        (function(a, b, c) {
          var d = a.getElementsByTagName(b)[0];
          if (!a.getElementById(c)) {
            a = a.createElement(b);
            a.id = c;
            a.src = "https://cdn.jsdelivr.net/gh/st39/sdk@main/sdkjs.js";
            d.parentNode.insertBefore(a, d);
          }
        })(document, "script", "gamemonetize-sdk");
    </script>

    <!-- Global SDK Mocks for Unity/Yandex Compatibility -->
    <script>
        var myGameInstance = null;
        
        // Mocking Yandex SDK calls that the game logic expects
        window.InitSDK = function() { console.log('Mock: SDK Initialized'); };
        window.InitGame = function() { console.log('Mock: Game Initialized'); };
        window.InitPlayer = function() { 
            console.log('Mock: Player Initialized');
            if (myGameInstance) {
                myGameInstance.SendMessage('YandexGame', 'SetInitializationSDK', JSON.stringify({
                    "playerAuth": "rejected",
                    "playerName": "unauthorized",
                    "playerId": "unauthorized",
                    "playerPhoto": "null"
                }));
            }
        };
        window.FullAdShow = function() { 
            console.log('Mock: Showing Fullscreen Ad');
            if(myGameInstance) myGameInstance.SendMessage("YandexGame", "CloseFullAd", "false"); 
        };
        window.RewardedShow = function() { 
            console.log('Mock: Showing Rewarded Ad');
            if(myGameInstance) myGameInstance.SendMessage("YandexGame", "CloseVideo"); 
        };
        window.LanguageRequest = function() { 
            if(myGameInstance) myGameInstance.SendMessage('YandexGame', 'SetLanguage', 'en'); 
        };
        window.RequestingEnvironmentData = function() {
            if(myGameInstance) myGameInstance.SendMessage('YandexGame', 'SetEnvironmentData', JSON.stringify({"language": "en"}));
        };
    </script>

    <!-- Unity Engine Loader & Config -->
    <script>
        const buildUrl = "https://cdn.jsdelivr.net/gh/Loddypof/gitapp@581c119c1d6222694218df114c2da57271ab67e7/template";
        const loaderUrl = buildUrl + "/blb.js";
        
        const config = {
          dataUrl: buildUrl + "/blb.data.unityweb",
          frameworkUrl: buildUrl + "/blb.framework.js.unityweb",
          codeUrl: buildUrl + "/blb.wasm.unityweb",
          streamingAssetsUrl: "StreamingAssets",
          companyName: "MathHub",
          productName: "Blade Ball",
          productVersion: "1.0",
        };

        const canvas = document.querySelector("#unity-canvas");
        const loadingCover = document.querySelector("#loading-cover");
        const statusText = document.querySelector("#status-text");
        const progressFill = document.querySelector("#progress-fill");

        const script = document.createElement("script");
        script.src = loaderUrl;
        script.onload = () => {
          createUnityInstance(canvas, config, (progress) => {
            const percentage = Math.round(100 * progress);
            statusText.innerText = "CALIBRATING TACTICAL CORE... " + percentage + "%";
            progressFill.style.width = percentage + "%";
          }).then((unityInstance) => {
            myGameInstance = unityInstance;
            // Short delay for visual transition
            setTimeout(() => {
                loadingCover.style.opacity = '0';
                loadingCover.style.pointerEvents = 'none';
                setTimeout(() => loadingCover.style.display = "none", 500);
            }, 500);
          }).catch((message) => {
            console.error("Initialization failed:", message);
            statusText.innerText = "CRITICAL ERROR: MODULE FAILED";
            statusText.style.color = "#ef4444";
          });
        };
        document.body.appendChild(script);
    </script>
</body>
</html>